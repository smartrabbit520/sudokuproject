import { writable } from 'svelte/store';
import { GRID_LENGTH, GRID_COORDS } from '@sudoku/constants';

function createCandidates() {
	const candidates = writable({});

	return {
		subscribe: candidates.subscribe,

		add(pos, candidate) {
			candidates.update($candidates => {
				if (!$candidates.hasOwnProperty(pos.x + ',' + pos.y)) {
					$candidates[pos.x + ',' + pos.y] = [candidate];
				} else if ($candidates[pos.x + ',' + pos.y].includes(candidate)) {
					delete $candidates[pos.x + ',' + pos.y][$candidates[pos.x + ',' + pos.y].indexOf(candidate)];
				} else {
					$candidates[pos.x + ',' + pos.y].push(candidate);
				}
				return $candidates;
			});
		},

		clear(pos) {
			candidates.update($candidates => {
				delete $candidates[pos.x + ',' + pos.y];
				return $candidates;
			});
		},

		clearAll() {
			console.log("clearAll");
			for (let cell = 0; cell < GRID_LENGTH; cell++) {
				const [row, col] = GRID_COORDS[cell];
				let pos = { x: row, y: col };
				if (!candidates.hasOwnProperty(pos.x + ',' + pos.y)) {
					this.clear(pos);
				}
			}
		}
	}
}

export const candidates = createCandidates();